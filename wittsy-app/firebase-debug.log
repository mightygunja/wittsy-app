[debug] [2026-01-01T23:38:11.122Z] ----------------------------------------------------------------------
[debug] [2026-01-01T23:38:11.125Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\might\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:rules
[debug] [2026-01-01T23:38:11.125Z] CLI Version:   14.17.0
[debug] [2026-01-01T23:38:11.125Z] Platform:      win32
[debug] [2026-01-01T23:38:11.126Z] Node Version:  v22.19.0
[debug] [2026-01-01T23:38:11.126Z] Time:          Thu Jan 01 2026 17:38:11 GMT-0600 (Central Standard Time)
[debug] [2026-01-01T23:38:11.126Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-01-01T23:38:11.391Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-01-01T23:38:11.392Z] > authorizing via signed-in user (mightygunja@gmail.com)
[debug] [2026-01-01T23:38:11.392Z] [iam] checking project wittsy-51992 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2026-01-01T23:38:11.393Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:11.393Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:11.394Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/wittsy-51992:testIamPermissions [none]
[debug] [2026-01-01T23:38:11.394Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/wittsy-51992:testIamPermissions x-goog-quota-user=projects/wittsy-51992
[debug] [2026-01-01T23:38:11.394Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/wittsy-51992:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2026-01-01T23:38:11.641Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/wittsy-51992:testIamPermissions 200
[debug] [2026-01-01T23:38:11.641Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/wittsy-51992:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'wittsy-51992'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-01-01T23:38:11.646Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:11.646Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:11.647Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992:test [none]
[debug] [2026-01-01T23:38:11.647Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992:test [omitted]
[debug] [2026-01-01T23:38:11.903Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992:test 200
[debug] [2026-01-01T23:38:11.903Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-01-01T23:38:11.905Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:11.905Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:11.905Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/wittsy-51992/databases/(default) [none]
[debug] [2026-01-01T23:38:12.181Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/wittsy-51992/databases/(default) 200
[debug] [2026-01-01T23:38:12.181Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/wittsy-51992/databases/(default) {"name":"projects/wittsy-51992/databases/(default)","uid":"8de41231-ca7f-4175-a312-6c81b4d434fa","createTime":"2025-12-18T06:52:21.075780Z","updateTime":"2025-12-18T06:52:21.075780Z","locationId":"us-central1","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"604800s","earliestVersionTime":"2025-12-25T23:39:00Z","appEngineIntegrationMode":"DISABLED","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_ENABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","backupConfig":{"backupSchedulesEnabled":true},"databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IM/EorDB65EDMLKZnMzk1JED"}
[debug] [2026-01-01T23:38:12.182Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.182Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.182Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/wittsy-51992/releases pageSize=10&pageToken=
[debug] [2026-01-01T23:38:12.243Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/wittsy-51992/releases 200
[debug] [2026-01-01T23:38:12.243Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/wittsy-51992/releases {"releases":[{"name":"projects/wittsy-51992/releases/cloud.firestore","rulesetName":"projects/wittsy-51992/rulesets/eca8e931-3bc4-429a-8c4e-caaef33927b2","createTime":"2025-12-18T06:52:22.262814Z","updateTime":"2026-01-01T23:31:44.665798Z"},{"name":"projects/wittsy-51992/releases/firebase.storage/wittsy-51992.firebasestorage.app","rulesetName":"projects/wittsy-51992/rulesets/3c884af7-9cdc-417a-873f-bea074346a43","createTime":"2025-12-18T19:31:47.963902Z","updateTime":"2025-12-18T19:33:48.124245Z"}]}
[debug] [2026-01-01T23:38:12.256Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.256Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.256Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/wittsy-51992/rulesets/eca8e931-3bc4-429a-8c4e-caaef33927b2 [none]
[debug] [2026-01-01T23:38:12.316Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/wittsy-51992/rulesets/eca8e931-3bc4-429a-8c4e-caaef33927b2 200
[debug] [2026-01-01T23:38:12.316Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/wittsy-51992/rulesets/eca8e931-3bc4-429a-8c4e-caaef33927b2 [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-01-01T23:38:12.318Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.318Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.319Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992/rulesets [none]
[debug] [2026-01-01T23:38:12.319Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992/rulesets [omitted]
[debug] [2026-01-01T23:38:12.500Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992/rulesets 200
[debug] [2026-01-01T23:38:12.500Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/wittsy-51992/rulesets {"name":"projects/wittsy-51992/rulesets/c150bbe6-3c01-499f-80fc-8fe16aba754c","source":{"files":[{"content":"rules_version = '2';\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // ==================== HELPER FUNCTIONS ====================\n    \n    function isSignedIn() {\n      return request.auth != null;\n    }\n    \n    function isOwner(userId) {\n      return request.auth.uid == userId;\n    }\n    \n    function isAdmin() {\n      return isSignedIn() && \n        (request.auth.token.email == 'mightygunja@gmail.com' || \n         request.auth.token.email == 'noshir2@gmail.com');\n    }\n    \n    function isValidString(text, minLen, maxLen) {\n      return text is string && \n        text.size() >= minLen && \n        text.size() <= maxLen;\n    }\n    \n    function isValidUsername(username) {\n      return isValidString(username, 3, 20) && \n        username.matches('^[a-zA-Z0-9_]+$');\n    }\n    \n    function hasValidTimestamp() {\n      return request.resource.data.createdAt is timestamp || \n        request.resource.data.createdAt is string;\n    }\n    \n    function isRecentTimestamp(ts) {\n      return ts > request.time - duration.value(1, 'h');\n    }\n    \n    \n    // ==================== USER DATA ====================\n    \n    match /users/{userId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && \n        isOwner(userId) && \n        isValidUsername(request.resource.data.username) &&\n        request.resource.data.coins >= 0 &&\n        request.resource.data.xp >= 0 &&\n        hasValidTimestamp();\n      allow update: if isSignedIn() && \n        isOwner(userId) &&\n        // Prevent negative values\n        request.resource.data.coins >= 0 &&\n        request.resource.data.xp >= 0 &&\n        // Prevent username changes after creation\n        (!('username' in request.resource.data) || \n         request.resource.data.username == resource.data.username);\n      allow delete: if false; // Users cannot delete their own accounts\n    }\n    \n    // ==================== GAME ROOMS ====================\n    \n    match /rooms/{roomId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update: if isSignedIn();\n      allow delete: if isSignedIn() && resource.data.hostId == request.auth.uid;\n    }\n    \n    match /prompts/{promptId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update, delete: if false;\n    }\n    \n    match /matches/{matchId} {\n      allow read: if isSignedIn();\n      allow write: if isSignedIn();\n    }\n    \n    match /leaderboards/{leaderboardId} {\n      allow read: if true;\n      allow write: if false;\n    }\n    \n    match /achievements/{userId} {\n      allow read: if isSignedIn();\n      allow write: if isSignedIn() && isOwner(userId);\n    }\n    \n    match /friendRequests/{requestId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update, delete: if isSignedIn() && (\n        resource.data.fromUserId == request.auth.uid ||\n        resource.data.toUserId == request.auth.uid\n      );\n    }\n    \n    // ==================== CHAT MESSAGES ====================\n    \n    match /chatMessages/{messageId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && \n        request.auth.uid == request.resource.data.userId &&\n        isValidString(request.resource.data.content, 1, 500) &&\n        hasValidTimestamp() &&\n        isRecentTimestamp(request.resource.data.timestamp);\n      allow update: if isSignedIn() && \n        resource.data.userId == request.auth.uid &&\n        // Only allow marking as edited\n        request.resource.data.content == resource.data.content;\n      allow delete: if isSignedIn() && (\n        resource.data.userId == request.auth.uid ||\n        isAdmin()\n      );\n    }\n    \n    // Seasons - allow app to create default season\n    match /seasons/{seasonId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update, delete: if false;\n    }\n    \n    // Season Stats - users can read their own and others\n    match /seasonStats/{statId} {\n      allow read: if isSignedIn();\n      allow write: if false; // Only backend updates stats\n    }\n    \n    // Rating History - users can read their own\n    match /ratingHistory/{historyId} {\n      allow read: if isSignedIn();\n      allow write: if false; // Only backend updates rating history\n    }\n    \n    // Prompts - allow app to seed prompts\n    match /prompts/{promptId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update, delete: if false;\n    }\n    \n    // ==================== CONTENT MODERATION ====================\n    \n    // Prompt Submissions - users can submit, read their own\n    match /promptSubmissions/{submissionId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && \n        request.auth.uid == request.resource.data.submittedBy &&\n        isValidString(request.resource.data.content, 1, 200) &&\n        hasValidTimestamp();\n      allow update: if isAdmin(); // Only admins can update (for moderation)\n      allow delete: if isAdmin();\n    }\n    \n    // Phrase Reports - users can report inappropriate content\n    match /phraseReports/{reportId} {\n      allow read: if isSignedIn() && (\n        resource.data.reportedBy == request.auth.uid ||\n        isAdmin()\n      );\n      allow create: if isSignedIn() && \n        request.auth.uid == request.resource.data.reportedBy &&\n        isValidString(request.resource.data.reason, 1, 500) &&\n        hasValidTimestamp();\n      allow update: if isAdmin(); // Only admins can review and update status\n      allow delete: if isAdmin();\n    }\n    \n    // Content Moderation Queue\n    match /moderationQueue/{queueId} {\n      allow read: if isAdmin();\n      allow write: if false; // Only backend can add to queue\n    }\n    \n    // User Prompt Preferences\n    match /userPromptPreferences/{userId} {\n      allow read: if isSignedIn();\n      allow write: if isSignedIn() && isOwner(userId);\n    }\n    \n    // Prompt Packs\n    match /promptPacks/{packId} {\n      allow read: if isSignedIn();\n      allow write: if false; // Only admins can create packs\n    }\n    \n    // ==================== SOCIAL FEATURES ====================\n    \n    // Friendships\n    match /friendships/{friendshipId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow delete: if isSignedIn() && resource.data.userId == request.auth.uid;\n    }\n    \n    // Friend Requests\n    match /friendRequests/{requestId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.fromUserId;\n      allow update: if isSignedIn() && (\n        resource.data.fromUserId == request.auth.uid ||\n        resource.data.toUserId == request.auth.uid\n      );\n      allow delete: if isSignedIn() && resource.data.fromUserId == request.auth.uid;\n    }\n    \n    // Game Invites\n    match /gameInvites/{inviteId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && request.auth.uid == request.resource.data.fromUserId;\n      allow update: if isSignedIn() && resource.data.toUserId == request.auth.uid;\n      allow delete: if isSignedIn() && (\n        resource.data.fromUserId == request.auth.uid ||\n        resource.data.toUserId == request.auth.uid\n      );\n    }\n    \n    // Challenges - allow app to seed challenges\n    match /challenges/{challengeId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update, delete: if false;\n    }\n    \n    // Challenge Progress\n    match /challengeProgress/{progressId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn() && \n        request.auth.uid == request.resource.data.userId &&\n        request.resource.data.progress >= 0;\n      allow update: if isSignedIn() && \n        resource.data.userId == request.auth.uid &&\n        // Prevent progress from decreasing (anti-cheat)\n        request.resource.data.progress >= resource.data.progress;\n      allow delete: if false;\n    }\n    \n    // Events\n    match /events/{eventId} {\n      allow read: if isSignedIn();\n      allow write: if false; // Only admins can create events\n      \n      // Event Participants\n      match /participants/{participantId} {\n        allow read: if isSignedIn();\n        allow create: if isSignedIn();\n        allow delete: if isSignedIn() && resource.data.userId == request.auth.uid;\n      }\n    }\n    \n    // Tournaments\n    match /tournaments/{tournamentId} {\n      allow read: if isSignedIn();\n      allow write: if false; // Only backend manages tournaments\n      \n      // Tournament Rounds\n      match /rounds/{roundId} {\n        allow read: if isSignedIn();\n        allow write: if false;\n        \n        // Tournament Matches\n        match /matches/{matchId} {\n          allow read: if isSignedIn();\n          allow write: if false; // Only backend updates matches\n        }\n      }\n      \n      // Tournament Leaderboard\n      match /leaderboard/{entryId} {\n        allow read: if isSignedIn();\n        allow write: if false;\n      }\n    }\n    \n    // Avatars - users can read/write their own avatar\n    match /avatars/{userId} {\n      allow read: if isSignedIn();\n      allow write: if isSignedIn() && isOwner(userId);\n    }\n    \n    // Battle Pass Seasons - allow app to create default season\n    match /battlePassSeasons/{seasonId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update, delete: if false;\n    }\n    \n    // User Battle Pass Progress\n    match /userBattlePass/{userId} {\n      allow read: if isSignedIn();\n      allow write: if isSignedIn() && isOwner(userId);\n    }\n    \n    // Battle Passes (alternative collection name)\n    match /battlePasses/{userId} {\n      allow read: if isSignedIn();\n      allow write: if isSignedIn() && isOwner(userId);\n    }\n    \n    // ==================== NOTIFICATIONS ====================\n    \n    match /notifications/{notificationId} {\n      allow read: if isSignedIn() && resource.data.userId == request.auth.uid;\n      allow create: if isSignedIn() && (\n        // Users can create notifications for themselves\n        request.resource.data.userId == request.auth.uid ||\n        // Or system can create for any user\n        isAdmin()\n      );\n      allow update: if isSignedIn() && \n        resource.data.userId == request.auth.uid &&\n        // Only allow marking as read\n        request.resource.data.read is bool;\n      allow delete: if isSignedIn() && resource.data.userId == request.auth.uid;\n    }\n    \n    // ==================== PURCHASES & TRANSACTIONS ====================\n    \n    // Purchase History\n    match /purchases/{purchaseId} {\n      allow read: if isSignedIn() && resource.data.userId == request.auth.uid;\n      allow create: if false; // Only backend can record purchases\n      allow update: if false;\n      allow delete: if false;\n    }\n    \n    // Transaction Log (for coins/currency)\n    match /transactions/{transactionId} {\n      allow read: if isSignedIn() && resource.data.userId == request.auth.uid;\n      allow create: if false; // Only backend can create transactions\n      allow update: if false;\n      allow delete: if false;\n    }\n    \n    // ==================== USER BLOCKING ====================\n    \n    // Blocked Users\n    match /blockedUsers/{userId} {\n      allow read: if isSignedIn() && isOwner(userId);\n      allow write: if isSignedIn() && isOwner(userId);\n    }\n    \n    // ==================== ADMIN ONLY ====================\n    \n    // System Configuration\n    match /config/{configId} {\n      allow read: if isSignedIn();\n      allow write: if isAdmin();\n    }\n    \n    // Analytics Events\n    match /analyticsEvents/{eventId} {\n      allow read: if false;\n      allow write: if false; // Only backend can write analytics\n    }\n  }\n}","name":"firestore.rules"}]},"createTime":"2026-01-01T23:38:12.804895Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-01-01T23:38:12.500Z] [rules] created ruleset projects/wittsy-51992/rulesets/c150bbe6-3c01-499f-80fc-8fe16aba754c
[debug] [2026-01-01T23:38:12.501Z] [rules] releasing cloud.firestore/(default) with ruleset projects/wittsy-51992/rulesets/c150bbe6-3c01-499f-80fc-8fe16aba754c
[debug] [2026-01-01T23:38:12.502Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.502Z] Checked if tokens are valid: true, expires at: 1767313797103
[debug] [2026-01-01T23:38:12.502Z] >>> [apiv2][query] PATCH https://firebaserules.googleapis.com/v1/projects/wittsy-51992/releases/cloud.firestore/(default) [none]
[debug] [2026-01-01T23:38:12.502Z] >>> [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/wittsy-51992/releases/cloud.firestore/(default) {"release":{"name":"projects/wittsy-51992/releases/cloud.firestore/(default)","rulesetName":"projects/wittsy-51992/rulesets/c150bbe6-3c01-499f-80fc-8fe16aba754c"}}
[debug] [2026-01-01T23:38:12.680Z] <<< [apiv2][status] PATCH https://firebaserules.googleapis.com/v1/projects/wittsy-51992/releases/cloud.firestore/(default) 200
[debug] [2026-01-01T23:38:12.680Z] <<< [apiv2][body] PATCH https://firebaserules.googleapis.com/v1/projects/wittsy-51992/releases/cloud.firestore/(default) {"name":"projects/wittsy-51992/releases/cloud.firestore","rulesetName":"projects/wittsy-51992/rulesets/c150bbe6-3c01-499f-80fc-8fe16aba754c","createTime":"2025-12-18T06:52:22.262814Z","updateTime":"2026-01-01T23:38:12.978649Z"}
[debug] [2026-01-01T23:38:12.680Z] [rules] updated release projects/wittsy-51992/releases/cloud.firestore
[info] +  firestore: released rules firestore.rules to cloud.firestore 
[info] 
[info] +  Deploy complete! 
[info] 
[info] Project Console: https://console.firebase.google.com/project/wittsy-51992/overview
[debug] [2026-01-01T23:38:17.903Z] Error: Timed out.
    at Timeout._onTimeout (C:\Users\might\AppData\Roaming\npm\node_modules\firebase-tools\lib\utils.js:275:49)
    at listOnTimeout (node:internal/timers:588:17)
    at process.processTimers (node:internal/timers:523:7)
[error] 
[error] Error: An unexpected error has occurred.
